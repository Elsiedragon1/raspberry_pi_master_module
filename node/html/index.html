<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Medusa</title>
        <!--<link href="style.css" rel="stylesheet"/>-->
        <style>
@import url('https://fonts.googleapis.com/css2?family=Palette+Mosaic&display=swap');

html, body, div {
    margin: 0;
    padding: 0;
    overflow: hidden;
}
body {
    background-color: #333;
    background-image: url(./1674714.jpg);
    background-size: cover;
}
.group {
    display: flex;
    padding-bottom: 10px;
}
.button {
    flex-grow: 1;
    display: inline-block;
    background-color: #ccc;
    text-align: center;
    vertical-align: middle;
    line-height: 45px;
    height: 45px;
    border-radius: 10px;
    margin: 2px;
    user-select: none;
    border: 0;
    box-shadow: none;
}
.button:hover {
    background-color: #999;
}
.button:active {
    background-color: #F69;
}
.feedbackBlock {
    display: inline-block;
    background-color: #ccc;
    text-align: center;
    vertical-align: middle;
    line-height: 45px;
    height: 45px;
    width: 200px;
    margin: 2px;
}
.feedback {
    flex-grow: 1;
    display: inline-block;
    background-color: #ccc;
    text-align: center;
    vertical-align: middle;
    line-height: 45px;
    height: 45px;
    margin: 2px;
}
#highscore {
    font-size: 128px;
    position: absolute;
    bottom: 0px;
    left: 0px;
}
#marquee {
    background: red;
    position: absolute;
    bottom: 20px;
    height: 220px;
    width: 100vw;
    overflow: hidden;
    background-image: url(./istockphoto-643964216-170667a.jpg);
    background-size: cover;
}
#marquee div {
    width: 200%;
    height: 220px;
    position: absolute;
    overflow: hidden;
    animation: marquee 30s linear infinite;
}
#marquee span {
  font-family: 'Palette Mosaic';
  float: left;
  width: 25%;
  height: 200px;
  font-size: 180px;
  transform: translateY(-20px);
}
@keyframes marquee {
  0% { left: 0; }
  100% { left: -100%; }
}
#message {
    display: block;
    height: 1000px;
    width: 100%;
    font-size: 720px;
    text-align: center;
    background-color: #aaa;
    background-image: url(./istockphoto-643964216-170667a.jpg);
    background-size: cover;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    /*-webkit-text-stroke: 3px #000000;*/
    /*text-shadow: 0px 0px 10px 10px #333*/
    -webkit-filter: drop-shadow(0px 0px 20px #000);
    filter: drop-shadow(0px 0px 20px #000);
    color: #c2131300;
    font-family: 'Palette Mosaic';
    transform-origin: center;
    transform: translateY(-100px) rotate(10deg);
}
dialog {
    min-width: 30%;
}
::backdrop {
    background-color: #000;
    opacity: 0.6;
}
        </style>
        <!--<script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>-->
        <script src="socket.io.min.js"></script>
    <!--sourceMappingURL=socket.io.min.js.map-->
    </head>
    <body>
        <dialog>
            Snake Heads (ID: 1)
            <div class="group">
                <div class="snakeFlames button" data-id="1">Fire 1</div>
                <div class="snakeFlames button" data-id="2">Fire 2</div>
                <div class="snakeFlames button" data-id="3">Fire 3</div>
                <div class="snakeFlames button" data-id="4">Fire 4</div>
            </div>
            <div class="group">
                <div class="snakeMouths button" data-id="0">Animate</div>
                <div class="snakeMouths button" data-id="1">Open Mouths</div>
                <div class="snakeMouths button" data-id="2">Close Mouths</div>
                <div class="snakeMouths button" data-id="3">Tongues Out</div>
            </div>
            <div class="group">
                <div class="snakeEyes button" data-id="0">Animate Eyes</div>
                <div class="snakeEyes button" data-id="1">Eyes On</div>
                <div class="snakeEyes button" data-id="2">Eyes Off</div>
            </div>
            Snake Bodies (ID: 2)
            <div class="group">
                <div class="snakeBody button" data-id="0">Home</div>
                <div class="snakeBody button" data-id="1">Dance</div>
                <div class="snakeBody button" data-id="2">Straighten Up!</div>
            </div>
            Saxaphones (ID: 3)
            <div class="group">
                <div class="saxFlame button" data-id="1">Fire 1</div>
                <div class="saxFlame button" data-id="2">Fire 2</div>
                <div class="saxFlame button" data-id="3">Fire 3</div>
                <div class="saxFlame button" data-id="4">Fire 4</div>
                <div class="saxFlame button" data-id="5">Fire 5</div>
            </div>
            Scissor Lift (ID: 4)
            <div class="group">
                <div class="scissor button" data-id="2">Raise</div>
                <div class="scissor button" data-id="4">STOP!</div>
                <div class="scissor button" data-id="0">Lower</div>
                <!--<div id="scissorStatus" class="feedbackBlock">UNKNOWN</div>-->
            </div>
            <!--
            <div class="group">
                <div class="scissorStop feedback" data-id="0">Bottom</div>
                <div class="scissorStop feedback" data-id="1">Top</div>
                <div class="scissorStop feedback" data-id="2">Emergency</div>
            </div>
            -->
            <button id="resetButton">Reset</button>
            <button id="closeDialog" autofocus>Close</button>
        </dialog>
        <button id="showDialog">Show the dialog</button>
        <div id="score">
        </div>
        <div id="highscore">
            138
        </div>
<!--    <div id="marquee">
            <div>
                <span>MODE</span>
                <span>MODE</span>
                <span>MODE</span>
                <span>MODE!</span>
            </div>
        </div>-->
        <div id="message">
            9013
        </div>

        <script>
const socket = io();

const STATE = {
    IDLE: 'idle',
    BUSK: 'busk',
    GAME: 'game'
}

const dialog = document.querySelector("dialog");
const showButton = document.getElementById("showDialog");
const closeButton = document.getElementById("closeDialog");
const resetButton = document.getElementById("resetButton");

const saxButtons = [...document.getElementsByClassName("saxFlame")];

const scissorButtons = [...document.getElementsByClassName("scissor")];
const scissorStatus = document.getElementById("scissorStatus");
const messageDisplay = document.getElementById("message");
const highscoreDisplay = document.getElementById("highscore");
const scissorStops= [...document.getElementsByClassName("scissorStop")];

const drumMode = [...document.getElementsByClassName("drumMode")];

const snakeFlames = [...document.getElementsByClassName("snakeFlames")];
const snakeMouths = [...document.getElementsByClassName("snakeMouths")];
const snakeEyes = [...document.getElementsByClassName("snakeEyes")];

const snakeBodies = [...document.getElementsByClassName("snakeBody")];


// "Show the dialog" button opens the dialog modally
showButton.addEventListener("click", () => {
  dialog.showModal();
  socket.emit('debugMode');
});

// "Close" button closes the dialog
closeButton.addEventListener("click", () => {
  dialog.close();
  socket.emit('gameMode');
});

// "Reset" button
resetButton.addEventListener("click", () => {
  socket.emit('reset');
});

for (var i = 0; i < snakeFlames.length; i++) {
    let id = snakeFlames[i].dataset.id;
    snakeFlames[i].addEventListener("click", () => {
        console.log("Fire Snake Flame " + id);
        socket.emit('snakeFlame', id);
    });
}

for (var i = 0; i < snakeMouths.length; i++) {
    let id = snakeMouths[i].dataset.id;
    snakeMouths[i].addEventListener("click", () => {
        console.log("Set snake mouths " + id);
        socket.emit('snakeMouth', id);
    });
}

for (var i = 0; i < snakeEyes.length; i++) {
    let id = snakeEyes[i].dataset.id;
    snakeEyes[i].addEventListener("click", () => {
        console.log("Set snake eyes " + id);
        socket.emit('snakeEye', id);
    });
}

for (var i = 0; i < saxButtons.length; i++) {
    let id = saxButtons[i].dataset.id;
    saxButtons[i].addEventListener("click", () => {
        console.log("Fire Saxaphone " + id);
        socket.emit('saxaphone', id);
    });
}

for (var i = 0; i < scissorButtons.length; i++) {
    let id = scissorButtons[i].dataset.id;
    scissorButtons[i].addEventListener("click", () => {
        console.log("Scissor Mode " + id);
        socket.emit('scissor', id);
    });
}

for (var i = 0; i < snakeBodies.length; i++) {
    let id = snakeBodies[i].dataset.id;
    snakeBodies[i].addEventListener("click", () => {
        console.log("SnakeBody mode " + id);
        socket.emit('snakeBody', id);
    });
}

let state = STATE.IDLE;

let highscore = 0;
let score = 0;

if (localStorage.getItem("highscore"))
{
    highscore = localStorage.getItem("highscore");
}
else
{
    localStorage.setItem("highscore", 0);
}

socket.on('score', function(data) {
    if (data != score)
    {
        console.log(data);
        score = data;
        messageDisplay.innerHTML = score;

        if (score > highscore)
        {
            highscore = score;
            highscoreDisplay.innerHTML = highscore;
            localStorage.setItem("highscore", highscore);
        }
    }
});

socket.on('scissorStatus', function(data) {
    console.log(data);
/*
#define LOWERED 0
#define RISE 1
#define RISEN 2
#define LOWER 3
#define STOP 4
#define ERROR 5
*/
    switch (data[0]) {
        case 0:
            scissorStatus.innerHTML = "LOWERED";
            scissorStatus.style.backgroundColor = "#0F0";
            break;
        case 1:
            scissorStatus.innerHTML = " RISE ";
            scissorStatus.style.backgroundColor = "#0FF";
            break;
        case 2:
            scissorStatus.innerHTML = "RISEN";
            scissorStatus.style.backgroundColor = "#00F";
            break;
        case 3:
            scissorStatus.innerHTML = "LOWER";
            scissorStatus.style.backgroundColor = "#0FF";
            break;
        case 4:
            scissorStatus.innerHTML = " STOP ";
            scissorStatus.style.backgroundColor = "#FF0";
            break;
        case 5:
            scissorStatus.innerHTML = "ERROR";
            scissorStatus.style.backgroundColor = "#F00";
            break;
        default:
            break;
    }
});

socket.on('scissorStop', function(data) {
    console.log(data);
    for (var i = 0; i < data.length; i++) {
        if (data[i] == false)
        {
            scissorStops[i].style.backgroundColor = "#3F3";
        } else {
            scissorStops[i].style.backgroundColor = "#F33";
        }
    }
});
        </script>
    </body>
</html>